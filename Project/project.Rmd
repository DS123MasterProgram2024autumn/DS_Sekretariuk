---
title: "Динаміка населення України"
author: "[Секретарюк В. О.](https://github.com/SquireUA), `r format(Sys.time(), '%Y')`"
date: "`r Sys.Date()`"
output:
#   pdf_document:
#     highlight: tango
#     toc: yes
#   word_document:
#     highlight: tango
#     toc: yes
  html_notebook:
    toc: yes # генерація змісту документу
    toc_float: true
    highlight: tango # Колір підсвічування коду
fontsize: 12pt # розмір шрифту
header-includes:
 \usepackage[T2A]{fontenc}
 \usepackage[utf8]{inputenc}
editor_options: 
  chunk_output_type: console # вивід результатів обчислень на консоль
---

```{r, echo=FALSE, results='hide',message=FALSE}
library(tidyverse)
library(rvest)
library(rio)
library(tidyr)
library(ggplot2)
library(dplyr)
library(stringr)
library(fpp2)
library(forecast)
```

### Динаміка зміни населення України за роками

Розглянемо динаміку населення України

```{r}
country <- read_html("https://vue.gov.ua/%D0%9D%D0%B0%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B8") |> 
  html_element(xpath = '//*[@id="mw-content-text"]/div/div[10]/table') |>
  html_table() |> 
  select(X1,X2) |> 
  filter(X1 < "Рік")

colnames(country)[1] ="Рік"
colnames(country)[2] ="Населення"

country$Населення <- gsub('* ','',country$Населення)

country <- transform(country, `Населення` = as.numeric(Населення))

tscountry <- ts(country |> select(Населення), start=1991)

autoplot(tscountry)+
  ggtitle("Населення України") +
  ylab("Кількість населення") +
  xlab("Рік")
```

Що ми бачимо?

- Після 1993 року присутній тренд на зниження кількості населення.
- Різке падіння після 2014 року пов'язане з початком війни в Україні.

#### Побудова ARIMA-моделі

Подивинося на ЧАКФ
```{r}
tscountry |> 
  ggPacf()
```

Ми бачимо один великий лаг на початку

Подивимося на АКФ

```{r}
tscountry |> 
  ggAcf()
```

Бачимо чітку тенденцію, тож потрібно продиференціювати числовий ряд

```{r}
tscountry.d <- tscountry |> 
  diff()

tscountry.d |> 
  autoplot()
```

На графіку бачино велике відхилення в 2015 році, що пов'язано з різким зниження населення з 2014 до 2015 року

Подивинося на ЧАКФ

```{r}
tscountry.d |> 
  ggPacf()
```

Подивимося на АКФ

```{r}
tscountry.d |> 
  ggAcf()
```

Побудуємо модель ARIMA(2,1,1)

```{r}
(fit <- Arima(tscountry.d, order=c(2,0,1)))
```

Модель має два значних показника ar1 та ma1

#### Побудова моделі прогнозу

На основі ARIMA-моделі побудуємо прогноз на 4 роки

```{r}
fit %>% 
  forecast(h=4) %>% 
  autoplot()
```

### Динаміка зміни населення України по кожній області окремо за роками

Розглянемо динаміку населення України по областям

```{r}
regions <- read_html("https://uk.wikipedia.org/wiki/%D0%A7%D0%B8%D1%81%D0%B5%D0%BB%D1%8C%D0%BD%D1%96%D1%81%D1%82%D1%8C_%D0%BD%D0%B0%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B8") |> 
  html_element(xpath = '//*[@id="mw-content-text"]/div[1]/table') |>
  html_table()
  
  
  

colnames(regions)[1] = 'Регіон'

regions <- regions |> 
  select(Регіон, `1991`:`2020`) |> 
  filter(Регіон != "Україна" & Регіон != "Київ" & Регіон != "Севастополь")

regions <- regions %>% 
  gather(Рік, value, -Регіон) %>% 
  spread(Регіон, value)

regions$`Автономна Республіка Крим` <- gsub('* ','',regions$`Автономна Республіка Крим`)
regions$`Автономна Республіка Крим` <- gsub('*,','.',regions$`Автономна Республіка Крим`)
regions$`Вінницька область` <- gsub('* ','',regions$`Вінницька область`)
regions$`Вінницька область` <- gsub('*,','.',regions$`Вінницька область`)
regions$`Волинська область` <- gsub('* ','',regions$`Волинська область`)
regions$`Волинська область` <- gsub('*,','.',regions$`Волинська область`)
regions$`Дніпропетровська область` <- gsub('* ','',regions$`Дніпропетровська область`)
regions$`Дніпропетровська область` <- gsub('*,','.',regions$`Дніпропетровська область`)
regions$`Донецька область` <- gsub('* ','',regions$`Донецька область`)
regions$`Донецька область` <- gsub('*,','.',regions$`Донецька область`)
regions$`Житомирська область` <- gsub('* ','',regions$`Житомирська область`)
regions$`Житомирська область` <- gsub('*,','.',regions$`Житомирська область`)
regions$`Закарпатська область` <- gsub('* ','',regions$`Закарпатська область`)
regions$`Закарпатська область` <- gsub('*,','.',regions$`Закарпатська область`)
regions$`Запорізька область` <- gsub('* ','',regions$`Запорізька область`)
regions$`Запорізька область` <- gsub('*,','.',regions$`Запорізька область`)
regions$`Івано-Франківська область` <- gsub('* ','',regions$`Івано-Франківська область`)
regions$`Івано-Франківська область` <- gsub('*,','.',regions$`Івано-Франківська область`)
regions$`Київська область` <- gsub('* ','',regions$`Київська область`)
regions$`Київська область` <- gsub('*,','.',regions$`Київська область`)
regions$`Кіровоградська область` <- gsub('* ','',regions$`Кіровоградська область`)
regions$`Кіровоградська область` <- gsub('*,','.',regions$`Кіровоградська область`)
regions$`Луганська область` <- gsub('* ','',regions$`Луганська область`)
regions$`Луганська область` <- gsub('*,','.',regions$`Луганська область`)
regions$`Львівська область` <- gsub('* ','',regions$`Львівська область`)
regions$`Львівська область` <- gsub('*,','.',regions$`Львівська область`)
regions$`Миколаївська область` <- gsub('* ','',regions$`Миколаївська область`)
regions$`Одеська область` <- gsub('* ','',regions$`Одеська область`)
regions$`Полтавська область` <- gsub('* ','',regions$`Полтавська область`)
regions$`Полтавська область` <- gsub('*,','.',regions$`Полтавська область`)
regions$`Рівненська область` <- gsub('* ','',regions$`Рівненська область`)
regions$`Рівненська область` <- gsub('*,','.',regions$`Рівненська область`)
regions$`Сумська область` <- gsub('* ','',regions$`Сумська область`)
regions$`Сумська область` <- gsub('*,','.',regions$`Сумська область`)
regions$`Тернопільська область` <- gsub('* ','',regions$`Тернопільська область`)
regions$`Тернопільська область` <- gsub('*,','.',regions$`Тернопільська область`)
regions$`Харківська область` <- gsub('* ','',regions$`Харківська область`)
regions$`Харківська область` <- gsub('*,','.',regions$`Харківська область`)
regions$`Херсонська область` <- gsub('* ','',regions$`Херсонська область`)
regions$`Херсонська область` <- gsub('*,','.',regions$`Херсонська область`)
regions$`Хмельницька область` <- gsub('* ','',regions$`Хмельницька область`)
regions$`Хмельницька область` <- gsub('*,','.',regions$`Хмельницька область`)
regions$`Черкаська область` <- gsub('* ','',regions$`Черкаська область`)
regions$`Черкаська область` <- gsub('*,','.',regions$`Черкаська область`)
regions$`Чернівецька область` <- gsub('* ','',regions$`Чернівецька область`)
regions$`Чернівецька область` <- gsub('*,','.',regions$`Чернівецька область`)
regions$`Чернігівська область` <- gsub('* ','',regions$`Чернігівська область`)
regions$`Чернігівська область` <- gsub('*,','.',regions$`Чернігівська область`)

regions <- transform(regions, `Автономна Республіка Крим` = as.numeric(`Автономна Республіка Крим`),
                     `Вінницька область` = as.numeric(`Вінницька область`),
                     `Волинська область` = as.numeric(`Волинська область`),
                     `Дніпропетровська область` = as.numeric(`Дніпропетровська область`),
                     `Донецька область` = as.numeric(`Донецька область`),
                     `Житомирська область` = as.numeric(`Житомирська область`),
                     `Закарпатська область` = as.numeric(`Закарпатська область`),
                     `Запорізька область` = as.numeric(`Запорізька область`),
                     `Івано-Франківська область` = as.numeric(`Івано-Франківська область`),
                     `Київська область` = as.numeric(`Київська область`),
                     `Кіровоградська область` = as.numeric(`Кіровоградська область`),
                     `Луганська область` = as.numeric(`Луганська область`),
                     `Львівська область` = as.numeric(`Львівська область`),
                     `Миколаївська область` = as.numeric(`Миколаївська область`),
                     `Одеська область` = as.numeric(`Одеська область`),
                     `Полтавська область` = as.numeric(`Полтавська область`),
                     `Рівненська область` = as.numeric(`Рівненська область`),
                     `Сумська область` = as.numeric(`Сумська область`),
                     `Тернопільська область` = as.numeric(`Тернопільська область`),
                     `Харківська область` = as.numeric(`Харківська область`),
                     `Херсонська область` = as.numeric(`Херсонська область`),
                     `Хмельницька область` = as.numeric(`Хмельницька область`),
                     `Черкаська область` = as.numeric(`Черкаська область`),
                     `Чернівецька область` = as.numeric(`Чернівецька область`),
                     `Чернігівська область` = as.numeric(`Чернігівська область`))

#regions

tsregions <- ts(regions |> select(-Рік), start=1991)

autoplot(tsregions)+
  ggtitle("Населення областей України") +
  ylab("Кількість населення") +
  xlab("Рік")
```

Що ми бачимо?

- Як і в ситуації зі спільною динамікою населення Населення в областях теж зменшується.
- Виключення є Київська область населення після 2009 року навпаки збільшується.
- Дивлячись на населення України по областям не видно вплав початку війни 2014 року.

### Динаміка зміни тривалості життя населення України по статі за роками

Розглянемо динаміку тривалості життя населення України по статі

```{r}
lifetime <- read_html("https://uk.wikipedia.org/wiki/%D0%A2%D1%80%D0%B8%D0%B2%D0%B0%D0%BB%D1%96%D1%81%D1%82%D1%8C_%D0%B6%D0%B8%D1%82%D1%82%D1%8F_%D0%B2_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D1%96") |> 
  html_element(xpath = '//*[@id="mw-content-text"]/div[1]/table[5]') |>
  html_table()

colnames(lifetime)[1] ="Рік"
colnames(lifetime)[3] ="Чоловіки"
colnames(lifetime)[4] ="Жінки"

lifetime <- lifetime |> 
  select(Рік, Чоловіки, Жінки) |> 
  filter(row_number() != 1) |> 
  filter(row_number() != 20)

lifetime$`Чоловіки` <- gsub('*,','.',lifetime$`Чоловіки`)
lifetime$`Жінки` <- gsub('*,','.',lifetime$`Жінки`)

lifetime <- transform(lifetime, Чоловіки = as.numeric(Чоловіки),
                      Жінки = as.numeric(Жінки))

tslifetime <- ts(lifetime |> select(-Рік), start=2002)

autoplot(tslifetime)+
  ggtitle("Тривалість життя в Україні") +
  ylab("Тривалість життя") +
  xlab("Рік")
```

Що ми бачимо?

- Тривалість життя жінок більше ніж чоловіків.
- Присутня тенденція на зростання тривалості життя.
- Значне підвищення після 2008 року.
- З 2019 року починається зменшення.
- Динаміка тривалості життя жінок та чоловіків подібні.
- Початок Війни в 2014 ніяк не повпливана на тривалість життя, що може означати, що дані про військових не включені в статистику.


### Динаміка зміни народжуваності та смертності населення України за роками

Розглянемо динаміку народжуваності та смертності України

```{r}
birthdeath <- import("data/birthdeath.csv") |> 
  filter(row_number() != 1) |> 
  filter(row_number() != 31)

birthdeath$DateTime <- substr(birthdeath$DateTime, start = 1, stop=4)
colnames(birthdeath)[which(names(birthdeath) == "DateTime")] <- "Рік"

tsbirthdeath <- ts(birthdeath |> select(-Рік), start=1991)

autoplot(tsbirthdeath)+
  ggtitle("Народжуваность та смертность населення України") +
  ylab("Число") +
  xlab("Рік")
```

Що ми бачимо?

- Померлих більше ніж народжених.
- Зменшення народжуваності під час 90-х, Збільшення народжуваності після 2000 року та різке зменшення після 2014 року, що пов'язано з початком війни.
- Різке збільшення смертності 1995 року.
- Загалом смертність підіймається до 2008 року пілся чого починається зниження.
- Початок війни в 2014 ніяк не повпливана на збільшення смертності, що, скоріше за все, означає, що смерті військових не включені в статистику.

### Висновки

1. Населення України поступово зменшується.
2. Війна значно повпливала на зменшення населення.
3. Люди переїжджають у Київ з інших областей.
4. Тривалість життя чоловікі та жінок мають подібну динаміку та поступово збільшується.
5. Смертність переважає народжуваність, що говорить про те що поліпшення демографічної ситуації поки що не відбудеться.